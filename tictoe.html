<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Tic Tac Toe</title>

	<style>
	canvas {
		display: block;
		border: 1px solid #000;
		margin: auto;
	}
	</style>
</head>
<body>
<script>
var canvas, ctx;
var data;
window.onload = function main(){
	canvas = document.createElement('canvas');
	canvas.width = canvas.height = 200;
	ctx = canvas.getContext('2d');

	document.body.appendChild(canvas);


	init();
	tick();

	function init() {
		data = new Tile(20,20);
		data.flip(Tile.NOUGHT);

	}

	function tick() {
		window.requestAnimationFrame(tick);

		update();
		render();
	}

	function update(){
		data.update();
	}
	function render(){
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		data.draw(ctx);
	}
	function Tile (x, y){

		var x = x, y =y;
		var tile = Tile.BLANK;

		if (tile == null) {
			var _c = document.createElement('canvas');
			_c.width = _c.height = 100;
			_ctx = _c.getContext('2d');

			_ctx.fillStyle = 'skyblue';
			_ctx.lineWidth = 4;
			_ctx.strokeStyle = "white";
			_ctx.lineCap = "round";
			//Blank
			_ctx.fillRect(0, 0, 100, 100);
			Tile.BLANK = new Image();
			Tile.BLANK.src = _c.toDataURL();

			//O
			_ctx.fillRect(0, 0, 100, 100);

			_ctx.beginPath();
			_ctx.arc(50, 50, 30, 0, 2*Math.PI);
			_ctx.stroke();

			Tile.NOUGHT = new Image();
			Tile.NOUGHT.src = _c.toDataURL();

			//X
			_ctx.fillRect(0, 0, 100, 100);

			_ctx.beginPath();
			_ctx.moveTo(20, 20);
			_ctx.lineTo(80, 80);
			_ctx.moveTo(80, 20);
			_ctx.lineTo(20, 80);
			_ctx.stroke();

			Tile.CROSS = new Image();
			Tile.CROSS.src = _c.toDataURL();

			tile = Tile.BLANK;


		}

		this.flip = function (next) {
			tile = next;
			anim = 1
		}
		this.update = function() {
			if (anim > 0) {
				anim -= 0.02;
			}

		}
		this.draw = function(ctx){
			if (anim <= 0) {
				ctx.drawImage(tile, x, y);
				return
			}
			var res = 2;
			var t = anim > 0.5 ? Tile.BLANK : tile;
			var p = -Math.abs(2 * anim -1)  + 1;

			for (var i = 0; i < 100; i += res) {
				var j = 50 - (anim > 0.5 ? 100- i : i); //remove 50 and swap 100 for a more forward motion
				ctx.drawImage(t, i, 0, res, 100,
					x + i -  p*i + 50*p,
					y - j*p*0.2,
					res,
					100 + j*p*0.4
				);
			}
			//ctx.drawImage(t, x, y);
		}
	}
}	
</script>
</body>
</html>